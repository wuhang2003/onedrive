<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, Chrome=1">
    <meta name="robots" content="noindex,nofollow">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no">
    <title>storage - /</title>
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/mdui@0.4.0/dist/css/mdui.min.css">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/highlight.js@9.15.6/styles/github.min.css">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/github-markdown-css@3.0.1/github-markdown.min.css">
    <style>
    body{background-color:#f2f5fa}.nexmoe-item{margin:20px -8px 0 !important;padding:15px !important;border-radius:5px;background-color:#fff;-webkit-box-shadow:0 .5em 3em rgba(161,177,204,.4);box-shadow:0 .5em 3em rgba(161,177,204,.4);background-color:#fff}.mdui-img-fluid,.mdui-video-fluid{border-radius:5px;border:1px solid #eee}.mdui-list{padding:0}.mdui-list-item{margin:0 !important;border-radius:5px;padding:0 10px 0 5px !important;border-bottom:1px solid #eee;margin-bottom:10px !important}.mdui-list-item:last-child{margin-bottom:0 !important}.mdui-toolbar{width:auto}.mdui-appbar .mdui-toolbar{height:56px;font-size:16px}.mdui-toolbar>*{padding:0 6px;margin:0 2px}.mdui-toolbar>.mdui-typo-headline{padding:0 16px 0 0}.mdui-toolbar>i{padding:0}.mdui-toolbar h3.title{padding:0 16px;line-height:30px;border-radius:30px;border:1px solid #eee;opacity:1;background-color:#1e89f2;color:#ffff}.mdui-toolbar>a:hover,a.mdui-typo-headline,a.active{opacity:1}.mdui-list>.th{background-color:initial}.mdui-list-item>a{width:100%;line-height:48px}.mdui-toolbar>a{padding:0 16px;line-height:30px;border-radius:30px;border:1px solid #eee}.mdui-toolbar>a:last-child{opacity:1;background-color:#1e89f2;color:#ffff}@media screen and (max-width:980px){.mdui-list-item .mdui-text-right{display:none}.mdui-container{width:100% !important;margin:0}.mdui-toolbar>a:last-child,.mdui-toolbar>.mdui-typo-headline,.mdui-toolbar>i:first-child{display:block}}#main-page{cursor:pointer}.nav-path{cursor:pointer}.nav-path:hover{text-decoration:underline}.file{width:100%;display:flex;align-items:center}.loading-wrapper{display:none;position:fixed;height:2em;line-height:2em;margin-top:.5em;width:100%;z-index:1}.loading{color:white;background:#dad7d7;height:100%;width:8em;margin:0 auto;text-align:center;border-radius:1em}.markdown-body{min-width:200px;margin:0 auto;padding:.7em 1em;font-size:1em}.markdown-body h1,h2,h3,h4,h5,h6{margin-top:0}.markdown-body img{max-width:90%;max-height:800px;width:auto;height:auto;display:block;margin:0 auto}.password{display:flex;align-items:center;margin:0 auto;padding-top:1em;display:none}
    </style>
    <script>
    window.GLOBAL_CONFIG = {
        SCF_GATEWAY: 'https://service-7x9otzr6-1256086190.ap-hongkong.apigateway.myqcloud.com/release/onedrive',
        SITE_NAME: '捞云盘'
    };
    </script>
</head>
<body hidden="hidden" class="mdui-theme-primary-blue-grey mdui-theme-accent-blue">
    <template id="file-wrapper-templete">
        <div class="row file-wrapper mdui-list-item mdui-ripple">
            <div class="file">
                <i class="mdui-icon material-icons">folder_open</i>
                <span class="name mdui-col-xs-12 mdui-col-sm-7 mdui-text-truncate"></span>
                <span class="time mdui-col-sm-3 mdui-text-right"></span>
                <span class="size mdui-col-sm-2 mdui-text-right"></span>
            </div>
        </div>
    </template>
    <div class="loading-wrapper">
        <div class="loading">Loading...</div>
    </div>
    <div class="container mdui-container">
        <div class="mdui-container-fluid">
            <div class="mdui-toolbar nexmoe-item nav">
                <i class="mdui-list-item-icon mdui-icon material-icons mdui-text-color-blue" id="main-page">home</i>
                <span id="path"></span>
            </div>
        </div>
        <div class="main mdui-container-fluid">
            <div class="nexmoe-item list-wrapper">
                <div class="list-header">
                    <div class="file mdui-list-item th">
                        <span class="name mdui-col-xs-12 mdui-col-sm-7">列表</span>
                        <span class="time mdui-col-sm-3 mdui-text-right">时间</span>
                        <span class="size mdui-col-sm-2 mdui-text-right">大小</span>
                    </div>
                </div>
                <div id="file-list">
                </div>
                <div class="markdown-body">
                    <div id="readme">
                    </div>
                </div>
                <div class="preview">
                    <div class="info">
                        <h3 class="file-name"></h3>
                        <p class="content"></p>
                        <p>
                            <button class="download mdui-btn mdui-btn-raised">下载</button>
                            <button class="quote mdui-btn mdui-btn-raised">引用</button>
                            <button class="share mdui-btn mdui-btn-raised">分享</button>
                        </p>
                    </div>
                </div>
                <div class="password">
                    <div class="mdui-textfield">
                        <input type="password" class="mdui-textfield-input">
                        <button class="mdui-btn mdui-color-theme-accent mdui-ripple" style="margin: 15px 0;">提交</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="//cdn.jsdelivr.net/npm/marked@0.6.0/marked.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/highlight.js@9.12.0/lib/highlight.min.js"></script>
    <script>
    function createCORSRequest(method, url) {
        let xhr = new XMLHttpRequest()
        if ("withCredentials" in xhr) {
            xhr.open(method, url, true)
        } else if (typeof XDomainRequest !== "undefined") {
            xhr = new XDomainRequest()
            xhr.open(method, url)
        } else {
            xhr = null
        }
        return xhr
    }

    function sendRequest(method, url, data, headers, callback, times) {
        let xhr = createCORSRequest(method, url)
        xhr.onreadystatechange = () => {
            if (xhr.readyState == 4 && xhr.status == 200) {
                callback(xhr.responseText)
            }
        }
        xhr.onerror = () => {
            times = times || 0
            console.log({
                url: url,
                data: data,
                times: times
            })
            if (times < 3) {
                sendRequest(method, url, data, headers, callback, times + 1)
            }
        }
        if (headers) {
            for (key in headers) {
                if (headers.hasOwnProperty(key)) {
                    xhr.setRequestHeader(key, headers[key])
                }
            }
        }
        if (data) {
            xhr.send(data)
        } else {
            xhr.send()
        }
    }

    function renderPage(data, cache) {
        let files
        if (data) {
            files = JSON.parse(data)
            window.fileCache.set(files.parent, files)
            preCache(files, 0)
        } else {
            files = cache
        }
        if (files.parent === window.backFordwardCache.current) {
            renderPath(files.parent)
            if (files.encrypted) {
                handleEncryptedFolder(files)
            } else {
                renderFileList(files)
            }
            // renderTreeNode(files)
        }
        if (document.body.getAttribute('hidden')) {
            document.body.removeAttribute('hidden')
        }
        document.querySelector('.loading-wrapper').style.display = 'none'
    }

    function renderPath(path) {
        const createPathSpan = (text, path) => {
            let pathSpan = document.createElement('span')
            pathSpan.innerHTML = text.length > 20 ? text.substring(0, 20) + '..' : text
            pathSpan.className = text === '/' ? 'nav-arr' : 'nav-path'
            if (path) {
                addPathListener(pathSpan, path)
            }
            return pathSpan
        }

        const paths = path.split('/')
        let pathSpanWrapper = document.getElementById('path')
        pathSpanWrapper.innerHTML = ''
        pathSpanWrapper.appendChild(createPathSpan(window.api.root))
        let continualPath = '/'
        for (let i = 1; i < paths.length - 1; i++) {
            continualPath += paths[i]
            pathSpanWrapper.appendChild(createPathSpan(paths[i], continualPath))
            pathSpanWrapper.appendChild(createPathSpan('/'))
            continualPath += '/'
        }
        pathSpanWrapper.appendChild(createPathSpan(paths[paths.length - 1]))
    }

    function renderFileList(files) {
        switchRightDisplay()

        const createFileWrapper = (type, name, time, size, path, url) => {
            let fileWrapper = document.getElementById('file-wrapper-templete').content.cloneNode(true)
            type = (type === 'folder') ? 'folder_open' : 'image_aspect_ratio'
            fileWrapper.querySelector('.mdui-icon').innerHTML = type
            fileWrapper.querySelector('.name').innerHTML = name
            fileWrapper.querySelector('.time').innerHTML = time
            fileWrapper.querySelector('.size').innerHTML = size
            addFileListLineListener(fileWrapper.querySelector('.row.file-wrapper'), path, url, size)
            return fileWrapper
        }

        const formatDate = date => {
            const addZero = num => num > 9 ? num : '0' + num
            date = new Date(date)
            const year = date.getFullYear()
            const month = addZero(date.getMonth() + 1)
            const day = addZero(date.getDate())
            const hour = addZero(date.getHours())
            const minute = addZero(date.getMinutes())
            const second = addZero(date.getSeconds())
            return 'yyyy-MM-dd HH:mm:ss'.replace('yyyy', year)
                .replace('MM', month)
                .replace('dd', day)
                .replace('HH', hour)
                .replace('mm', minute)
                .replace('ss', second)
        }

        const formatSize = size => {
            let count = 0
            while (size >= 1024) {
                size /= 1024
                count++
            }
            size = size.toFixed(2)
            switch (count) {
                case 1:
                    size += ' KB'
                    break
                case 2:
                    size += ' MB'
                    break
                case 3:
                    size += ' GB'
                    break
                default:
                    size += ' TB'
                    break
            }
            return size
        }

        let fileList = document.getElementById('file-list')
        fileList.innerHTML = ''
        files.files.forEach(file => {
            if (file.name.split('.').pop() === 'md') {
                if (file.url) {
                    renderReadme(files.parent + '/' + file.name, file.url)
                }
            } else {
                const parent = files.parent === window.api.root ? '' : files.parent
                fileList.appendChild(createFileWrapper(
                    file.url ? 'document' : 'folder',
                    file.name,
                    formatDate(file.time),
                    formatSize(file.size),
                    parent + '/' + file.name,
                    file.url
                ))
            }
        })
    }

    async function renderReadme(path, url) {
        const render = text => {
            let markedText
            try {
                markedText = marked(text, {
                    gfm: true,
                    highlight: (code, lang, callback) => {
                        return hljs.highlight(lang, code).value
                    }
                })
            } catch (e) {
                markedText = marked(text, {
                    gfm: true,
                    highlight: (code, lang, callback) => {
                        return hljs.highlight('bash', code).value
                    }
                })
            }
            if (window.backFordwardCache.current + '/README.md' === path) {
                if (!window.backFordwardCache.preview) {
                    document.getElementById('readme').innerHTML = markedText
                    document.querySelector('.markdown-body').style.display = 'block'
                }
            }
            let cache = window.fileCache.get(path)
            if (!cache || cache === true) {
                window.fileCache.set(path, text)
            }
        }
        let text = window.fileCache.get(path)
        if (text === true) {
            let cacheWaitReadmeFetch = setInterval(() => {
                text = window.fileCache.get(path)
                if (text !== true) {
                    render(text, path)
                    clearInterval(cacheWaitReadmeFetch)
                }
            }, 100)
        } else if (text) {
            render(text, path)
        } else {
            window.fileCache.set(path, true)
            sendRequest('GET', url, null, null, text => render(text, path))
        }
    }

    function handleEncryptedFolder(files) {
        switchRightDisplay('encrypted')
        const password = document.querySelector('.password')
        const button = password.querySelector('button')
        const input = password.querySelector('input')
        input.placeholder = '请输入密码'
        button.addEventListener('click', event => {
            const passwd = input.value
            if (!input.value) {
                return
            }
            input.value = ''
            input.placeholder = '正在验证..'
            sendRequest(window.api.method,
                window.api.url,
                window.api.formatPayload(files.parent, passwd),
                window.api.headers,
                data => {
                    const newFiles = JSON.parse(data)
                    if (newFiles.encrypted) {
                        input.placeholder = '密码错误'
                    } else {
                        window.fileCache.set(newFiles.parent, newFiles)
                        fetchFileList(newFiles.parent)
                    }
                }
            )
        })
    }

    function addPathListener(elem, path) {
        elem.addEventListener('click', event => {
            fetchFileList(path)
            switchBackForwardStatus(path)
        })
    }

    function addTreeNodeListener(elem, path) {
        elem.addEventListener('click', event => {
            fetchFileList(path)
            switchBackForwardStatus(path)
        })
    }

    function addFileListLineListener(elem, path, url, size) {
        if (url) {
            elem.addEventListener('click', event => {
                window.backFordwardCache.preview = true
                const previewHandler = {
                    copyTextContent: (source, text) => {
                        let result = false
                        let target = document.createElement('pre')
                        target.style.opacity = '0'
                        target.textContent = text || source.textContent
                        document.body.appendChild(target)
                        try {
                            let range = document.createRange()
                            range.selectNode(target)
                            window.getSelection().removeAllRanges()
                            window.getSelection().addRange(range)
                            document.execCommand('copy')
                            window.getSelection().removeAllRanges()
                            result = true
                        } catch (e) {}
                        document.body.removeChild(target)
                        return result
                    },
                    fileType: suffix => {
                        if (['bmp', 'jpg', 'png', 'svg', 'webp', 'gif'].indexOf(suffix) >= 0) {
                            return 'image'
                        } else if (['mp3', 'flac', 'wav'].indexOf(suffix) >= 0) {
                            return 'audio'
                        } else if (['mp4', 'avi', 'mkv', 'flv', 'm3u8'].indexOf(suffix) >= 0) {
                            return 'video'
                        } else if (
                            [
                                'txt', 'js', 'json', 'css', 'html', 'java', 'c', 'cpp', 'php',
                                'cmd', 'ps1',
                                'bat', 'sh', 'py', 'go', 'asp',
                            ].indexOf(suffix) >= 0
                        ) {
                            return 'text'
                        }
                    },
                    loadResource: (resource, callback) => {
                        let type
                        switch (resource.split('.').pop()) {
                            case 'css':
                                type = 'link'
                                break
                            case 'js':
                                type = 'script'
                                break
                        }
                        let element = document.createElement(type)
                        let loaded = false
                        if (typeof callback === 'function') {
                            element.onload = element.onreadystatechange = () => {
                                if (!loaded && (!element.readyState || /loaded|complete/.test(
                                        element.readyState))) {
                                    element.onload = element.onreadystatechange = null
                                    loaded = true
                                    callback()
                                }
                            }
                        }
                        if (type === 'link') {
                            element.href = resource
                            element.rel = 'stylesheet'
                        } else {
                            element.src = resource
                        }
                        document.getElementsByTagName('head')[0].appendChild(element)
                    },

                    createDplayer: (video, type, elem) => {
                        const host = '//cdn.jsdelivr.net/npm/'
                        const resources = [
                            'dplayer@1.25.0/dist/DPlayer.min.css',
                            'dplayer@1.25.0/dist/DPlayer.min.js',
                            'hls.js@0.12.4/dist/hls.light.min.js',
                            'flv.js@1.5.0/dist/flv.min.js'
                        ]
                        let unloadedResourceCount = resources.length
                        resources.forEach(resource => {
                            previewHandler.loadResource(host + resource, () => {
                                if (!--unloadedResourceCount) {
                                    let option = {
                                        url: video
                                    }
                                    if (type === 'flv') {
                                        option.type = 'flv'
                                    }
                                    new DPlayer({
                                        container: elem,
                                        screenshot: true,
                                        video: option
                                    })
                                }
                            })
                        })
                    }
                }
                const suffix = path.split('.').pop()
                let content = document.querySelector('.content')
                switch (previewHandler.fileType(suffix)) {
                    case 'image':
                        let img = new Image()
                        img.style.maxWidth = '100%'
                        img.src = url
                        let fancy = document.createElement('a')
                        fancy.setAttribute('data-fancybox', 'image')
                        fancy.href = img.src
                        fancy.append(img)
                        content.innerHTML = ''
                        content.append(fancy)
                        break
                    case 'audio':
                        let audio = new Audio()
                        audio.style.outline = 'none'
                        audio.preload = 'auto'
                        audio.controls = 'controls'
                        audio.style.width = '100%'
                        audio.src = url
                        content.innerHTML = ''
                        content.append(audio)
                        break
                    case 'video':
                        let video = document.createElement('div')
                        previewHandler.createDplayer(url, suffix, video)
                        content.innerHTML = ''
                        content.append(video)
                        break
                    case 'text':
                        let pre = document.createElement('pre')
                        let code = document.createElement('code')
                        pre.append(code)
                        pre.style.background = 'rgb(245,245,245)'
                        pre.style['overflow-x'] = 'scroll'
                        pre.classList.add(suffix)
                        content.style['text-align'] = 'initial'
                        content.innerHTML = ''
                        content.append(pre)
                        sendRequest('GET', url, null, null, data => {
                            code.textContent = data
                            if (size.indexOf(' B') >= 0 || size.indexOf(' KB') &&
                                size.split(' ')[0] < 100
                            ) {
                                hljs.highlightBlock(pre)
                            }
                        })
                        break
                    default:
                        content.style['text-align'] = 'center'
                        content.innerHTML = '该文件不支持预览'
                }
                document.querySelector('.file-name').innerHTML = path
                document.querySelector('.download').addEventListener('click',
                    () => location.href = url
                )
                document.querySelector('.quote').addEventListener('click',
                    event => {
                        previewHandler.copyTextContent(null, window.api.url + '?file=' + path)
                        const btn = document.querySelector('.quote')
                        btn.innerHTML = '已复制'
                        setTimeout(() => btn.innerHTML = '引用', 250)
                    }
                )
                document.querySelector('.share').addEventListener('click',
                    event => {
                        const sharePath = () => {
                            let arr = window.backFordwardCache.current.split('/')
                            let r = ''
                            for (let i = 1; i < arr.length; i++) {
                                r += '/' + arr[i]
                            }
                            return r
                        }
                        previewHandler.copyTextContent(null,
                            window.location.origin +
                            window.location.pathname +
                            '?path=' + sharePath())
                        const btn = document.querySelector('.share')
                        btn.innerHTML = '已复制'
                        setTimeout(() => btn.innerHTML = '分享', 250)
                    }
                )
                switchRightDisplay('preview')
            })
        } else {
            elem.addEventListener('click', event => {
                fetchFileList(path)
                switchBackForwardStatus(path)
            })
        }
    }

    function addBackForwardListener() {
        document.querySelector('#main-page').addEventListener('click', () => {
            fetchFileList(window.api.root)
            switchBackForwardStatus(window.api.root)
        })
    }

    function switchRightDisplay(display) {
        if (display === 'preview') {
            document.querySelector('.list-header').style.display = 'none'
            document.querySelector('#file-list').style.display = 'none'
            document.querySelector('.markdown-body').style.display = 'none'
            document.querySelector('.password').style.display = 'none'
            document.querySelector('.preview').style.display = 'initial'
        } else if (display === 'encrypted') {
            document.querySelector('.list-header').style.display = 'none'
            document.querySelector('#file-list').style.display = 'none'
            document.querySelector('.markdown-body').style.display = 'none'
            document.querySelector('.preview').style.display = 'none'
            document.querySelector('.password').style.display = 'initial'
        } else {
            document.querySelector('.list-header').style.display = 'initial'
            document.querySelector('#file-list').style.display = 'initial'
            document.querySelector('.markdown-body').style.display = 'none'
            document.querySelector('.preview').style.display = 'none'
            document.querySelector('.password').style.display = 'none'
        }
    }

    function switchBackForwardStatus(path) {
        if (path) {
            window.backFordwardCache.deepest = path
        }
        if (window.backFordwardCache.root !== window.backFordwardCache.current) {
            window.backFordwardCache.backable = true
            // document.getElementById('arrow-back').style.color = 'black'
        } else {
            window.backFordwardCache.backable = false
            // document.getElementById('arrow-back').style.color = 'rgb(218, 215, 215)'
        }
        if (window.backFordwardCache.deepest !== window.backFordwardCache.current) {
            window.backFordwardCache.forwardable = true
            // document.getElementById('arrow-forward').style.color = 'black'
        } else {
            window.backFordwardCache.forwardable = false
            // document.getElementById('arrow-forward').style.color = 'rgb(218, 215, 215)'
        }
    }

    function back() {
        if (!window.backFordwardCache.backable) {
            return
        }
        if (window.backFordwardCache.preview) {
            fetchFileList(window.backFordwardCache.current)
        } else {
            let former = (() => {
                let formerEndIndex = window.backFordwardCache.current.lastIndexOf('/')
                return window.backFordwardCache.current.substring(0, formerEndIndex)
            })()
            former = former || window.api.root
            fetchFileList(former)
            switchBackForwardStatus()
        }
        // console.log(window.backFordwardCache)
    }

    function forward() {
        if (!window.backFordwardCache.forwardable) {
            return
        }
        const current = window.backFordwardCache.current === window.api.root ? '' : window.backFordwardCache.current
        const subLength = current ? current.length : 0
        const later = current + '/' +
            window.backFordwardCache.deepest.substring(subLength).split('/')[1]
        fetchFileList(later)
        switchBackForwardStatus()
        // console.log(window.backFordwardCache)
    }

    async function preCache(files, level) {
        if (level > 2) return
        files.files.forEach(file => {
            const parent = files.parent === '/' ? '' : files.parent
            const path = parent + '/' + file.name
            if (!file.url) {
                // console.log('caching ' + path + ', level ' + level)
                window.fileCache.set(path, true)
                sendRequest(window.api.method,
                    window.api.url,
                    window.api.formatPayload(path),
                    window.api.headers,
                    data => {
                        const files = JSON.parse(data)
                        window.fileCache.set(path, files)
                        preCache(files, level + 1)
                    }
                )
            } else if (file.name.split('.').pop() === 'md') {
                // console.log('caching ' + path + ', level ' + level)
                window.fileCache.set(path, true)
                sendRequest('GET', file.url, null, null, text => window.fileCache.set(path, text))
            }
        })
    }

    async function preCacheCheck(cache, path) {
        cache.files.forEach(file => {
            const prefix = path === window.api.root ? '' : path
            const nextPath = prefix + '/' + file.name
            const pathCache = window.fileCache.get(nextPath)
            if (!file.url) {
                if (!pathCache && pathCache !== true) {
                    // console.log('inner caching ' + nextPath)
                    window.fileCache.set(nextPath, true)
                    sendRequest(window.api.method,
                        window.api.url,
                        window.api.formatPayload(nextPath),
                        window.api.headers,
                        data => {
                            const files = JSON.parse(data)
                            window.fileCache.set(nextPath, files)
                            preCache(files, 0)
                        }
                    )
                }
            } else if (file.name.split('.').pop() === 'md') {
                if (!pathCache && pathCache !== true) {
                    // console.log('inner caching ' + nextPath)
                    window.fileCache.set(nextPath, true)
                    sendRequest('GET', file.url, null, null, text => window.fileCache.set(nextPath,
                        text))
                }
            }
        })
    }

    function fetchFileList(path) {
        // console.log('fetching ' + path)
        document.querySelector('.loading-wrapper').style.display = 'initial'
        window.backFordwardCache.preview = false
        window.backFordwardCache.current = path
        let cache = window.fileCache.get(path)
        if (cache === true) {
            let cacheWaitFileListFetch = setInterval(() => {
                cache = window.fileCache.get(path)
                if (cache !== true) {
                    renderPage(null, cache)
                    preCacheCheck(cache, path)
                    clearInterval(cacheWaitFileListFetch)
                }
            }, 100)
        } else if (cache) {
            renderPage(null, cache)
            preCacheCheck(cache, path)
        } else {
            window.fileCache.set(path, true)
            sendRequest(window.api.method,
                window.api.url,
                window.api.formatPayload(path),
                window.api.headers,
                renderPage
            )
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        document.title = window.GLOBAL_CONFIG.SITE_NAME
        window.api = {
            root: '/',
            url: window.GLOBAL_CONFIG.SCF_GATEWAY,
            method: 'POST',
            formatPayload: (path, passwd) => {
                return 'path=' + encodeURIComponent(path) +
                    '&encrypted=' + window.api.accessToken.encrypted +
                    '&plain=' + window.api.accessToken.plain +
                    '&passwd=' + passwd
            },
            headers: {
                'Content-type': 'application/x-www-form-urlencoded'
            }
        }
        window.backFordwardCache = {
            root: window.api.root,
            deepest: window.api.root,
            current: window.api.root,
            backable: false,
            forwardable: false,
            preview: false
        }
        window.fileCache = new Map()
        const initialPath = new URLSearchParams(window.location.search).get('path') || window.api.root
        sendRequest(window.api.method,
            window.api.url + '?accessToken',
            null,
            window.api.headers,
            data => {
                const accessToken = JSON.parse(data)
                window.api.accessToken = {
                    encrypted: accessToken.encrypted,
                    plain: accessToken.plain
                }
                fetchFileList(initialPath)
                addBackForwardListener()
            }
        )
    })
    </script>
</body>

</html>
